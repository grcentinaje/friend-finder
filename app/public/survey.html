<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Friend Finder Survey</title>

    <!-- Latest compiled and minified CSS & JS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

</head>

<body>

    <!-- Button trigger modal -->
    <!-- <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
        Launch demo modal
      </button> -->

    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Your most compatible friend is</p>
                    <h2 id="finalFriend">You</h2>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">

        <div class="jumbotron">
            <h1 class="text-center">Friend Finder Survey</h1>
            <hr>
            <h3 class="text-center">On a scale from 1-5 (1 you completely disagree,<br>5 you completely agree), rate
                each
                statement.</h3>
            <br>
        </div>
        <div class="row">
            <div class="col-lg-12">
                <!-- Questions -->
                <div class="card">
                    <div class="card-body">
                        <form role="form" id="q1">
                            <h4>1) I enjoy speaking to people in person rather than on a mobile device.</h4>
                            <br>
                            <input type="radio" name="q1" value="1"> 1
                            <input type="radio" name="q1" value="2"> 2
                            <input type="radio" name="q1" value="3"> 3
                            <input type="radio" name="q1" value="4"> 4
                            <input type="radio" name="q1" value="5"> 5
                        </form>
                        <br><br>

                        <form role="form" id="q2">
                            <h4>2) I give second chances.</h4>
                            <br>
                            <input type="radio" name="q2" value="1"> 1
                            <input type="radio" name="q2" value="2"> 2
                            <input type="radio" name="q2" value="3"> 3
                            <input type="radio" name="q2" value="4"> 4
                            <input type="radio" name="q2" value="5"> 5
                        </form>
                        <br><br>

                        <form role="form" id="q3">
                            <h4>3) I prefer to have "me" time most of the time.</h4>
                            <br>
                            <input type="radio" name="q3" value="1"> 1
                            <input type="radio" name="q3" value="2"> 2
                            <input type="radio" name="q3" value="3"> 3
                            <input type="radio" name="q3" value="4"> 4
                            <input type="radio" name="q3" value="5"> 5
                        </form>
                        <br><br>

                        <form role="form" id="q4">
                            <h4>4) I enjoy spending time with other people.</h4>
                            <br>
                            <input type="radio" name="q4" value="1"> 1
                            <input type="radio" name="q4" value="2"> 2
                            <input type="radio" name="q4" value="3"> 3
                            <input type="radio" name="q4" value="4"> 4
                            <input type="radio" name="q4" value="5"> 5
                        </form>
                        <br><br>

                        <form role="form" id="q5">
                            <h4>5) I am adventurous.</h4>
                            <br>
                            <input type="radio" name="q5" value="1"> 1
                            <input type="radio" name="q5" value="2"> 2
                            <input type="radio" name="q5" value="3"> 3
                            <input type="radio" name="q5" value="4"> 4
                            <input type="radio" name="q5" value="5"> 5
                        </form>
                        <br><br>

                        <form role="form" id="q6">
                            <h4>6) A great evening includes staying home watching Netflix and bingeing on junk food.
                            </h4>
                            <br>
                            <input type="radio" name="q6" value="1"> 1
                            <input type="radio" name="q6" value="2"> 2
                            <input type="radio" name="q6" value="3"> 3
                            <input type="radio" name="q6" value="4"> 4
                            <input type="radio" name="q6" value="5"> 5
                        </form>
                        <br><br>

                        <form role="form" id="q7">
                            <h4>7) I am athletic.</h4>
                            <br>
                            <input type="radio" name="q7" value="1"> 1
                            <input type="radio" name="q7" value="2"> 2
                            <input type="radio" name="q7" value="3"> 3
                            <input type="radio" name="q7" value="4"> 4
                            <input type="radio" name="q7" value="5"> 5
                        </form>
                        <br><br>

                        <form role="form" id="q8">
                            <h4>8) I love trying new things.</h4>
                            <br>
                            <input type="radio" name="q8" value="1"> 1
                            <input type="radio" name="q8" value="2"> 2
                            <input type="radio" name="q8" value="3"> 3
                            <input type="radio" name="q8" value="4"> 4
                            <input type="radio" name="q8" value="5"> 5
                        </form>
                        <br><br>

                        <form role="form" id="q9">
                            <h4>9) I love Disney.</h4>
                            <br>
                            <input type="radio" name="q9" value="1"> 1
                            <input type="radio" name="q9" value="2"> 2
                            <input type="radio" name="q9" value="3"> 3
                            <input type="radio" name="q9" value="4"> 4
                            <input type="radio" name="q9" value="5"> 5
                        </form>
                        <br><br>

                        <form role="form" id="q10">
                            <h4>10) I am outgoing.</h4>
                            <br>
                            <input type="radio" name="q10" value="1"> 1
                            <input type="radio" name="q10" value="2"> 2
                            <input type="radio" name="q10" value="3"> 3
                            <input type="radio" name="q10" value="4"> 4
                            <input type="radio" name="q10" value="5"> 5
                        </form>
                        <br><br>

                        <button type="submit" class="btn btn-primary submit">Submit</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

    </div>

</body>

</html>

<!-- BELOW CODE IS CRITICAL. IT HANDLES HOW FORM DATA IS SENT TO OUR SERVER -->
<script type="text/javascript">
    // In this code below we create the Front-end JavaScript which "POSTS" our form data to our express server.
    // In essence, when the user hits submit, jQuery grabs all of the fields then sends a post request to our api
    // Our api recognizes the route (/api/tables)... and then runs the associated code (found in api-routes.js).
    // In this case the associated code "saves" the data to the table-data.js file or waitinglist-data.js file

    $(".submit").on("click", function (event) {

        event.preventDefault();

        // Here we grab the form elements
        var userRatings = [
            $("input[name='q1']:checked").val(),
            $("input[name='q2']:checked").val(),
            $("input[name='q3']:checked").val(),
            $("input[name='q4']:checked").val(),
            $("input[name='q5']:checked").val(),
            $("input[name='q6']:checked").val(),
            $("input[name='q7']:checked").val(),
            $("input[name='q8']:checked").val(),
            $("input[name='q9']:checked").val(),
            $("input[name='q10']:checked").val()
        ];

        console.log(userRatings);

        function runFriendQuery() {
            // The AJAX function uses the URL of our API to GET the data associated with it (initially set to localhost)
            $.ajax({ url: "/api/friends", method: "GET" })
                .then(function (friendsData) {
                    var lowestDiff = 999999;
                    var lowestIndex = null; //Index of User with the least difference in score
                    for (var i = 0; i < friendsData.length; i++) {
                        var friend = friendsData[i];

                        var sum = 0;
                        for (var j = 0; j < 10; j++) {
                            sum += Math.abs(userRatings[j] - friend.scores[j]);
                        };

                        if (sum < lowestDiff) {
                            lowestDiff = sum;
                            lowestIndex = i;
                        }

                    };

                    console.log(friendsData[lowestIndex]);

                });
        };

        runFriendQuery();



        $.post("/api/survey", userRatings,
            function (data) {

                // If a table is available... tell user they are booked.
                // if (data) {
                //   alert("Yay! You are officially booked!");
                // }

                // // If a table is available... tell user they on the waiting list.
                // else {
                //   alert("Sorry you are on the wait list");
                // }

                // Clear the form when submitting
                $("#q1").val("");
                $("#q2").val("");
                $("#q3").val("");
                $("#q4").val("");
                $("#q5").val("");
                $("#q6").val("");
                $("#q7").val("");
                $("#q8").val("");
                $("#q9").val("");
                $("#q10").val("");
            });

        $("#exampleModal").modal("show");

    });

</script>